---
title: "Analysis for spoana LT"
author: "y.hira"
date: "2/17/2019"
output:
  html_document:
    toc: true
    #number_sections: true
    fig_caption: true
    md_extensions: -ascii_identifiers
    code_folding: hide
    toc_float: true
    theme: lumen
    highlight: tango
---

# Introduction {.tabset .tabset-fade .tabset-pills}

# Preparation {.tabset .tabset-fade .tabset-pills}

## Load Libraries
```{r, message=FALSE}
library(tidyverse)
library(kableExtra)
library(viridis)
library(gganimate)
library(gifski)
library(png)
library(patchwork)
```

## Read Data
```{r}
df <- readr::read_csv("merged.csv")
```

##  Set Options
```{r}
#ggplotの文字化け対策
theme_set( theme_bw(base_family = "HiraKakuProN-W3"))
```

# Data Check {.tabset .tabset-fade .tabset-pills}

## glimpse()
```{r}
df %>% dplyr::glimpse()
```

## summary()
```{r}
df %>% summary()
```

# EDA {.tabset .tabset-fade .tabset-pills}

## surface

*Top50 players
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]")-> p1

df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p2

df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p3

df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p4

(p1 + p2) / (p3 + p4)
```

*Top10 players
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]")-> p1

df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p2

df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p3

df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlim(0, 55) +
  ylim(55, 100) +
  xlab("break[%]") +
  ylab("keep[%]") -> p4

(p1 + p2) / (p3 + p4)
```

## Top50 players(surface == "All")
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top10 players(surface == "All")
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "All") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top50 players(surface == "Clay")
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top10 players(surface == "Clay")
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Clay") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top50 players(surface == "Grass")
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top10 players(surface == "Grass")
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Grass") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top50 players(surface == "Hard")
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 50 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

## Top10 players(surface == "Hard")
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
  xlab("break[%]") +
  ylab("keep[%]")
```

* animation
```{r}
df %>% 
  dplyr::filter(ranking <= 10 & matches > 5 & surface == "Hard") %>% 
  ggplot(aes(x=percentage_return, y=percentage_service, color=ranking, size=matches)) +
  geom_point() +
  scale_color_viridis() +
# Here comes the gganimate specific bits
  labs(title = 'year: {frame_time}', x = 'break[%]', y = 'keep[%]') +
  transition_time(as.integer(year)) + 
  ease_aes('linear') #-> a

#animate(a, fps=1)
```

